<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ± å–µå¡ Milka - æ¼‚äº®çš„è®°å¿†é—ªå¡åº”ç”¨</title>
    <meta name="description" content="åŸºäºæ‡’çŒ«å¾®æœçš„è½»é‡çº§è®°å¿†é—ªå¡åº”ç”¨ï¼Œæ”¯æŒè‡ªå®šä¹‰ç•Œé¢åŠå†…å®¹ï¼Œå¸®åŠ©ç”¨æˆ·å­¦ä¹ è¯­è¨€ã€èƒŒè¯µçŸ¥è¯†ç‚¹">
    <meta name="keywords" content="è®°å¿†å¡ç‰‡,é—ªå¡,å­¦ä¹ å·¥å…·,æ‡’çŒ«å¾®æœ,MiniDB">
    <meta name="author" content="CATxPAPA@gmail.com">
    
    <!-- é¢„åŠ è½½å…³é”®èµ„æº -->
    <link rel="preload" href="./assets/css/base.css" as="style">
    
    <!-- æ ·å¼è¡¨ -->
    <link rel="stylesheet" href="./assets/css/base.css">
    <link rel="stylesheet" href="./assets/css/forms.css">
    <link rel="stylesheet" href="./assets/css/componets.css">
    <!-- PWA æ”¯æŒ -->
    <!-- <link rel="manifest" href="./manifest.json"> -->
    <meta name="theme-color" content="#667eea">
    
    <!-- å›¾æ ‡ -->
    <link rel="icon" type="image/png" sizes="32x32" href="./assets/logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./assets/logo.png">
    <link rel="apple-touch-icon" href="./assets/icons/apple-touch-icon.png">
    
    <!-- ç¤¾äº¤åª’ä½“å…ƒæ ‡ç­¾ -->
    <meta property="og:title" content="å–µå¡ Milka - è®°å¿†é—ªå¡åº”ç”¨">
    <meta property="og:description" content="æ¼‚äº®çš„è®°å¿†é—ªå¡åº”ç”¨ï¼Œæ”¯æŒè‡ªå®šä¹‰ç•Œé¢åŠå†…å®¹">
    <meta property="og:type" content="website">
    <meta property="og:image" content="./assets/icons/og-image.png">
    
    <!-- å­—ä½“é¢„åŠ è½½ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- åº”ç”¨åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div id="loading" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner">
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
            </div>
            <h2>ğŸ± å–µå¡æ­£åœ¨å¯åŠ¨...</h2>
            <p>æ­£åœ¨åˆå§‹åŒ–åº”ç”¨å’Œæ•°æ®åº“è¿æ¥</p>
        </div>
    </div>

    <!-- ä¸»åº”ç”¨å®¹å™¨ -->
    <div id="app" class="app-container">
        <!-- åº”ç”¨å†…å®¹å°†é€šè¿‡ JavaScript åŠ¨æ€æ¸²æŸ“ -->
        <div class="app-placeholder">
            <div class="placeholder-content">
                <h1>ğŸ± å–µå¡ Milka</h1>
                <p>æ­£åœ¨åŠ è½½åº”ç”¨...</p>
                <div class="placeholder-spinner">
                    <div class="bounce1"></div>
                    <div class="bounce2"></div>
                    <div class="bounce3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥å®¹å™¨ -->
    <div id="notifications" class="notifications-container"></div>

    <!-- æ¨¡æ€æ¡†å®¹å™¨ -->
    <div id="modal-container" class="modal-container"></div>

    <!-- é”®ç›˜å¿«æ·é”®å¸®åŠ© -->
    <div id="keyboard-help" class="keyboard-help hidden">
        <div class="keyboard-help-content">
            <h3>âŒ¨ï¸ é”®ç›˜å¿«æ·é”®</h3>
            <div class="shortcut-list">
                <div class="shortcut-item">
                    <kbd>ç©ºæ ¼</kbd>
                    <span>ç¿»è½¬å½“å‰å¡ç‰‡</span>
                </div>
                <div class="shortcut-item">
                    <kbd>â†</kbd> <kbd>â†’</kbd>
                    <span>åˆ‡æ¢å¡ç‰‡</span>
                </div>
                <div class="shortcut-item">
                    <kbd>ESC</kbd>
                    <span>è¿”å›ä¸Šçº§</span>
                </div>
                <div class="shortcut-item">
                    <kbd>Ctrl</kbd> + <kbd>N</kbd>
                    <span>æ–°å»ºä¸»é¢˜/å¡ç‰‡</span>
                </div>
                <div class="shortcut-item">
                    <kbd>?</kbd>
                    <span>æ˜¾ç¤º/éšè—å¸®åŠ©</span>
                </div>
            </div>
            <button class="btn btn-secondary" onclick="app.hideKeyboardHelp()">å…³é—­</button>
        </div>
    </div>

    <!-- é”™è¯¯è¾¹ç•Œ -->
    <div id="error-boundary" class="error-boundary hidden">
        <div class="error-content">
            <h2>ğŸ˜¿ åº”ç”¨é‡åˆ°äº†é—®é¢˜</h2>
            <p>å¾ˆæŠ±æ­‰ï¼Œåº”ç”¨è¿è¡Œæ—¶å‡ºç°äº†é”™è¯¯ã€‚</p>
            <div class="error-actions">
                <button class="btn btn-primary" onclick="location.reload()">
                    ğŸ”„ é‡æ–°åŠ è½½
                </button>
                <button class="btn btn-secondary" onclick="app.reportError()">
                    ğŸ“ æŠ¥å‘Šé—®é¢˜
                </button>
            </div>
        </div>
    </div>

    <!-- è„šæœ¬åŠ è½½ -->
    <script type="importmap">
    {
        "imports": {
            "@lazycatcloud/minidb": "https://cdn.skypack.dev/@lazycatcloud/minidb"
        }
    }
    </script>

    <!-- ä¸»åº”ç”¨è„šæœ¬ -->
    <script type="module" src="./app.js"></script>

    <!-- å…¨å±€é”™è¯¯å¤„ç† -->
    <script>
        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', (event) => {
            console.error('ğŸš¨ å…¨å±€é”™è¯¯:', event.error);
            
            // æ˜¾ç¤ºé”™è¯¯è¾¹ç•Œ
            const errorBoundary = document.getElementById('error-boundary');
            if (errorBoundary) {
                errorBoundary.classList.remove('hidden');
            }
            
            // éšè—åŠ è½½æŒ‡ç¤ºå™¨
            const loading = document.getElementById('loading');
            if (loading) {
                loading.style.display = 'none';
            }
        });

        // æœªå¤„ç†çš„ Promise æ‹’ç»
        window.addEventListener('unhandledrejection', (event) => {
            console.error('ğŸš¨ æœªå¤„ç†çš„ Promise æ‹’ç»:', event.reason);
            event.preventDefault();
        });

        // é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible' && window.app) {
                // é¡µé¢é‡æ–°å¯è§æ—¶åˆ·æ–°æ•°æ®
                console.log('ğŸ“± é¡µé¢é‡æ–°å¯è§ï¼Œæ£€æŸ¥æ•°æ®æ›´æ–°');
                if (window.app.checkForUpdates) {
                    window.app.checkForUpdates();
                }
            }
        });

        // ç½‘ç»œçŠ¶æ€ç›‘å¬
        window.addEventListener('online', () => {
            console.log('ğŸŒ ç½‘ç»œè¿æ¥å·²æ¢å¤');
            if (window.app && window.app.showNotification) {
                window.app.showNotification('ç½‘ç»œè¿æ¥å·²æ¢å¤', 'success');
                if (window.app.syncData) {
                    window.app.syncData();
                }
            }
        });

        window.addEventListener('offline', () => {
            console.log('ğŸ“µ ç½‘ç»œè¿æ¥å·²æ–­å¼€');
            if (window.app && window.app.showNotification) {
                window.app.showNotification('ç½‘ç»œè¿æ¥å·²æ–­å¼€ï¼Œåº”ç”¨å°†åœ¨ç¦»çº¿æ¨¡å¼ä¸‹è¿è¡Œ', 'warning');
            }
        });

        // é¡µé¢åŠ è½½æ€§èƒ½ç›‘æ§
        window.addEventListener('load', () => {
            setTimeout(() => {
                const perfData = performance.getEntriesByType('navigation')[0];
                if (perfData) {
                    const loadTime = perfData.loadEventEnd - perfData.loadEventStart;
                    
                    console.log('ğŸ“Š é¡µé¢åŠ è½½æ€§èƒ½:', {
                        loadTime: `${loadTime}ms`,
                        domContentLoaded: `${perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart}ms`,
                        firstPaint: performance.getEntriesByType('paint')[0]?.startTime || 'N/A'
                    });
                    
                    // å¦‚æœåŠ è½½æ—¶é—´è¿‡é•¿ï¼Œæ˜¾ç¤ºæç¤º
                    if (loadTime > 3000) {
                        console.warn('âš ï¸ é¡µé¢åŠ è½½æ—¶é—´è¾ƒé•¿ï¼Œå»ºè®®ä¼˜åŒ–');
                    }
                }
            }, 0);
        });

        // å¼€å‘ç¯å¢ƒè°ƒè¯•å·¥å…·
        if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
            console.log('ğŸ”§ å¼€å‘æ¨¡å¼å·²å¯ç”¨');
            
            // æ·»åŠ è°ƒè¯•å¿«æ·é”®
            document.addEventListener('keydown', (event) => {
                // Ctrl + Shift + D æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
                if (event.ctrlKey && event.shiftKey && event.key === 'D') {
                    console.log('ğŸ› è°ƒè¯•ä¿¡æ¯:', {
                        userAgent: navigator.userAgent,
                        viewport: `${window.innerWidth}x${window.innerHeight}`,
                        timestamp: new Date().toISOString(),
                        app: window.app?.state || 'Not initialized'
                    });
                }
            });
        }
    </script>


</body>
</html>